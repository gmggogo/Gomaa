<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SUNBEAM TRANSPORTATION â€“ Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="layout.css">

<style>

/* ===============================
   DASHBOARD STYLE
=============================== */

.dashboard-wrapper{
  max-width:1500px;
  margin:auto;
  padding:40px 20px;
}

.section-title{
  font-size:22px;
  font-weight:700;
  color:#0f172a;
  margin-bottom:25px;
}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:25px;
}

.card{
  background:#fff;
  padding:25px;
  border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
  transition:.3s;
}

.card:hover{
  transform:translateY(-5px);
}

.card h3{
  margin:0;
  font-size:15px;
  color:#475569;
}

.card p{
  margin-top:15px;
  font-size:30px;
  font-weight:700;
  color:#1e3a8a;
}

/* TABLE */

.table-section{
  margin-top:50px;
}

table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 6px 16px rgba(0,0,0,.08);
}

th,td{
  padding:12px;
  font-size:13px;
  border-bottom:1px solid #eee;
  text-align:left;
}

th{
  background:#0f172a;
  color:#fff;
}

tr:hover{
  background:#f9fafb;
}

@media(max-width:768px){
  .card p{
    font-size:22px;
  }
}

</style>
</head>

<body>

<div id="layoutHeader"></div>

<div class="dashboard-wrapper">

  <!-- TODAY STATS -->
  <div class="section-title">Today's Activity</div>

  <div class="cards">

    <div class="card">
      <h3>Total Today</h3>
      <p id="totalTrips">0</p>
    </div>

    <div class="card">
      <h3>Completed</h3>
      <p id="completedTrips">0</p>
    </div>

    <div class="card">
      <h3>No Show</h3>
      <p id="noShowTrips">0</p>
    </div>

    <div class="card">
      <h3>Cancelled</h3>
      <p id="cancelledTrips">0</p>
    </div>

  </div>

  <!-- MONTH STATS -->
  <div class="section-title" style="margin-top:60px;">This Month</div>

  <div class="cards">

    <div class="card">
      <h3>Total Trips</h3>
      <p id="monthTrips">0</p>
    </div>

  </div>

  <!-- LAST 5 TRIPS -->
  <div class="table-section">
    <div class="section-title">Last 5 Trips</div>

    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Pickup</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="lastTripsBody">
      </tbody>
    </table>

  </div>

</div>

<script src="layout.js"></script>

<script>

/* =================================
   LOAD DASHBOARD DATA
================================= */

async function loadDashboard(){

  try{

    const res = await fetch("/api/company/dashboard", {
      credentials:"include"
    });

    if(res.status === 401){
      window.location.href = "company-login.html";
      return;
    }

    const data = await res.json();

    // TODAY
    document.getElementById("totalTrips").innerText = data.today.total;
    document.getElementById("completedTrips").innerText = data.today.completed;
    document.getElementById("noShowTrips").innerText = data.today.noShow;
    document.getElementById("cancelledTrips").innerText = data.today.cancelled;

    // MONTH
    document.getElementById("monthTrips").innerText = data.month.total;

    // LAST 5
    const tbody = document.getElementById("lastTripsBody");
    tbody.innerHTML = "";

    data.lastTrips.forEach(trip => {

      const row = `
        <tr>
          <td>${trip.date}</td>
          <td>${trip.pickup}</td>
          <td>${trip.status}</td>
        </tr>
      `;

      tbody.innerHTML += row;

    });

  }catch(err){
    console.error("Dashboard error:", err);
  }

}

loadDashboard();

</script>

</body>
</html>