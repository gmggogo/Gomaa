<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>GPS Test</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body{margin:0}
    #map{height:100vh}
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const driver = JSON.parse(localStorage.getItem("loggedDriver"));
if(!driver || !driver.id){
  alert("Driver not logged");
}

const map = L.map("map").setView([33.3, -111.8], 13);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 19
}).addTo(map);

let marker = null;
let lastSaved = 0;

navigator.geolocation.watchPosition(
  pos => {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;

    if(!marker){
      marker = L.marker([lat,lng]).addTo(map).bindPopup("You");
    } else {
      marker.setLatLng([lat,lng]);
    }

    const now = Date.now();
    if(now - lastSaved > 15000){
      lastSaved = now;

      localStorage.setItem(
        `driver_location_${driver.id}`,
        JSON.stringify({lat,lng,timestamp:now})
      );

      console.log("ðŸ“ saved", lat, lng);
    }
  },
  err => alert("GPS error"),
  { enableHighAccuracy:true }
);
</script>

</body>
</html>